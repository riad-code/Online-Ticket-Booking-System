<style>
    .nav-sidebar .nav-link.active {
        background-color: #28a745 !important;
        color: #fff !important;
        font-weight: 500
    }

        .nav-sidebar .nav-link.active i, .nav-sidebar .nav-link.active p {
            color: #fff !important
        }

        .nav-sidebar .nav-link.active:focus, .nav-sidebar .nav-link.active:active {
            background-color: #e6f7f0 !important;
            color: #1DBF73 !important
        }

        .nav-sidebar .nav-link.active:hover {
            background-color: #e6f7f0 !important;
            color: #1DBF73 !important
        }

            .nav-sidebar .nav-link.active:hover i, .nav-sidebar .nav-link.active:hover p {
                color: #1DBF73 !important
            }

    .nav-sidebar .nav-treeview .nav-link {
        color: #fff;
        background-color: transparent;
        transition: background-color .3s,color .3s
    }

        .nav-sidebar .nav-treeview .nav-link:hover {
            background-color: #28a745 !important;
            color: #fff !important
        }

        .nav-sidebar .nav-treeview .nav-link.active {
            background-color: #198754 !important;
            color: #fff !important
        }

        .nav-sidebar .nav-treeview .nav-link .nav-icon {
            color: #fff !important
        }

        .nav-sidebar .nav-treeview .nav-link:focus, .nav-sidebar .nav-treeview .nav-link:active {
            background-color: #28a745 !important;
            color: #fff !important
        }

    .nav-sidebar .nav-treeview .nav-link {
        color: black !important;
        background-color: #fff !important
    }

        .nav-sidebar .nav-treeview .nav-link .nav-icon {
            color: #000 !important
        }

        .nav-sidebar .nav-treeview .nav-link:hover .nav-icon {
            color: #fff !important
        }
</style>

@{
    var currentController = ViewContext.RouteData.Values["controller"]?.ToString();
    var currentAction = ViewContext.RouteData.Values["action"]?.ToString();

    bool IsController(params string[] controllers) =>
        controllers.Any(c => string.Equals(c, currentController, StringComparison.OrdinalIgnoreCase));

    bool IsControllerActionStartsWith(string controller, string actionPrefix) =>
        string.Equals(currentController, controller, StringComparison.OrdinalIgnoreCase)
        && currentAction?.StartsWith(actionPrefix, StringComparison.OrdinalIgnoreCase) == true;

    // Sections
    bool isAirSectionActive = IsController("Airlines", "Airports", "FareClasses", "FlightSchedules");
    bool isEventsActive = IsController("Events");
    bool isParksActive = IsController("Parks");

    // ✅ NEW: Events tree active (to open/highlight the submenu)
    bool isEventsTreeActive =
        string.Equals(currentController, "Events", StringComparison.OrdinalIgnoreCase) &&
        (string.Equals(currentAction, "AdminIndex", StringComparison.OrdinalIgnoreCase)
         || string.Equals(currentAction, "Create", StringComparison.OrdinalIgnoreCase)
         || string.Equals(currentAction, "Edit", StringComparison.OrdinalIgnoreCase)
         || string.Equals(currentAction, "Delete", StringComparison.OrdinalIgnoreCase)
         || string.Equals(currentAction, "Details", StringComparison.OrdinalIgnoreCase));
}

<nav class="mt-2">
    <ul class="nav nav-pills nav-sidebar flex-column" data-widget="treeview" role="menu" data-accordion="false">

        <!-- Admin Dashboard -->
        <li class="nav-item">
            <a asp-controller="Admin" asp-action="Dashboard"
               class="nav-link @(IsController("Admin") && currentAction?.StartsWith("Dashboard", StringComparison.OrdinalIgnoreCase) == true ? "active" : "")">
                <i class="nav-icon fas fa-tachometer-alt"></i>
                <p>Dashboard</p>
            </a>
        </li>

        <!-- Manage Users -->
        <li class="nav-item">
            <a asp-controller="Admin" asp-action="ManageUsers"
               class="nav-link @(IsController("Admin") && currentAction?.StartsWith("ManageUsers", StringComparison.OrdinalIgnoreCase) == true ? "active" : "")">
                <i class="nav-icon fas fa-users-cog"></i>
                <p>Manage Users</p>
            </a>
        </li>

        <!-- Manage Schedules -->
        <li class="nav-item">
            <a asp-controller="Schedule" asp-action="Index"
               class="nav-link @(IsController("Schedule") ? "active" : "")">
                <i class="nav-icon fas fa-calendar-alt"></i>
                <p>Manage Bus Schedules</p>
            </a>
        </li>

        <!-- Manage Vehicles Dropdown -->
        @{
            bool isManageVehiclesActive =
            IsController("Bus", "Air", "Train", "Launch") ||
            IsControllerActionStartsWith("Admin", "ManageBuses");
        }
        <li class="nav-item text-success has-treeview @(isManageVehiclesActive ? "menu-open" : "")">
            <a href="#" class="nav-link @(isManageVehiclesActive ? "active" : "")">
                <i class="nav-icon fas fa-bus"></i>
                <p>
                    Manage Vehicles
                    <i class="right fas fa-angle-left"></i>
                </p>
            </a>
            <ul class="nav nav-treeview">
                <li class="nav-item">
                    <a asp-controller="Admin" asp-action="ManageBuses"
                       class="nav-link @(IsControllerActionStartsWith("Admin", "ManageBuses") ? "active" : "")">
                        <i class="fas fa-bus nav-icon text-black"></i>
                        <p>Manage Bus</p>
                    </a>
                </li>

                <li class="nav-item has-treeview @(isAirSectionActive ? "menu-open" : "")">
                    <a href="#" class="nav-link @(isAirSectionActive ? "active" : "")">
                        <i class="fas fa-plane nav-icon text-black"></i>
                        <p>
                            Manage Air
                            <i class="right fas fa-angle-left"></i>
                        </p>
                    </a>
                    <ul class="nav nav-treeview">
                        <li class="nav-item">
                            <a asp-controller="Airlines" asp-action="Index"
                               class="nav-link @(IsController("Airlines") ? "active" : "")">
                                <p>Airlines</p>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a asp-controller="Airports" asp-action="Index"
                               class="nav-link @(IsController("Airports") ? "active" : "")">
                                <p>Airports</p>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a asp-controller="FareClasses" asp-action="Index"
                               class="nav-link @(IsController("FareClasses") ? "active" : "")">
                                <p>Fare Classes</p>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a asp-controller="FlightSchedules" asp-action="Index"
                               class="nav-link @(IsController("FlightSchedules") ? "active" : "")">
                                <p>Flight Schedules</p>
                            </a>
                        </li>
                    </ul>
                </li>

                <li class="nav-item">
                    <a asp-controller="Train" asp-action="Index"
                       class="nav-link @(IsController("Train") ? "active" : "")">
                        <i class="fas fa-train nav-icon text-black"></i>
                        <p>Manage Train</p>
                    </a>
                </li>
            </ul>
        </li>

        <!-- Manage Operators -->
        <li class="nav-item">
            <a asp-controller="UserManagement" asp-action="Operator"
               class="nav-link @(IsController("UserManagement") && currentAction?.StartsWith("Operator", StringComparison.OrdinalIgnoreCase) == true ? "active" : "")">
                <i class="nav-icon fas fa-user-tie"></i>
                <p>Manage Operators</p>
            </a>
        </li>

        <!-- Manage Tickets Dropdown -->
        <li class="nav-item has-treeview @(IsController("AdminTickets") || IsController("AdminAirTickets") ? "menu-open" : "")">
            <a href="#" class="nav-link @(IsController("AdminTickets") || IsController("AdminAirTickets") ? "active" : "")">
                <i class="nav-icon fas fa-ticket-alt"></i>
                <p>
                    Manage Tickets
                    <i class="right fas fa-angle-left"></i>
                </p>
            </a>
            <ul class="nav nav-treeview">
                <li class="nav-item">
                    <a asp-controller="AdminTickets" asp-action="Index"
                       class="nav-link @(IsController("AdminTickets") ? "active" : "")">
                        <i class="far fa-circle nav-icon"></i>
                        <p>Bus Tickets</p>
                    </a>
                </li>
                <li class="nav-item">
                    <a asp-controller="AdminAirTickets" asp-action="Index"
                       class="nav-link @(IsController("AdminAirTickets") ? "active" : "")">
                        <i class="far fa-circle nav-icon"></i>
                        <p>Air Tickets</p>
                    </a>
                </li>
            </ul>
        </li>

        <!-- ✅ Events (treeview like Parks) -->
        <li class="nav-item has-treeview @(isEventsTreeActive ? "menu-open" : "")">
            <a href="#" class="nav-link @(isEventsTreeActive ? "active" : "")">
                <i class="nav-icon fas fa-calendar-check"></i>
                <p>
                    Events
                    <i class="right fas fa-angle-left"></i>
                </p>
            </a>
            <ul class="nav nav-treeview">
                <li class="nav-item">
                    <!-- Admin list -->
                    <a asp-controller="Events" asp-action="AdminIndex"
                       class="nav-link @(string.Equals(currentController,"Events",StringComparison.OrdinalIgnoreCase)
                                                               && string.Equals(currentAction, "AdminIndex", StringComparison.OrdinalIgnoreCase) ? "active" : "")">
                        <i class="far fa-circle nav-icon"></i>
                        <p>Manage Events</p>
                    </a>
                </li>
                <li class="nav-item">
                    <!-- Quick create -->
                    <a asp-controller="Events" asp-action="Create"
                       class="nav-link @(string.Equals(currentController,"Events",StringComparison.OrdinalIgnoreCase)
                                                               && string.Equals(currentAction, "Create", StringComparison.OrdinalIgnoreCase) ? "active" : "")">
                        <i class="far fa-circle nav-icon"></i>
                        <p>Create Event</p>
                    </a>
                </li>
            </ul>
        </li>

        <!-- ✅ Parks -->
        <li class="nav-item has-treeview @(isParksActive ? "menu-open" : "")">
            <a href="#" class="nav-link @(isParksActive ? "active" : "")">
                <i class="nav-icon fas fa-tree"></i>
                <p>
                    Parks
                    <i class="right fas fa-angle-left"></i>
                </p>
            </a>
            <ul class="nav nav-treeview">
                <li class="nav-item">
                    <a asp-controller="Parks" asp-action="AdminIndex"
                       class="nav-link @(IsController("Parks") && string.Equals(currentAction, "AdminIndex", StringComparison.OrdinalIgnoreCase) ? "active" : "")">
                        <i class="far fa-circle nav-icon"></i>
                        <p>Manage Parks</p>
                    </a>
                </li>
                <li class="nav-item">
                    <a asp-controller="Parks" asp-action="Create"
                       class="nav-link @(IsController("Parks") && string.Equals(currentAction, "Create", StringComparison.OrdinalIgnoreCase) ? "active" : "")">
                        <i class="far fa-circle nav-icon"></i>
                        <p>Create Park</p>
                    </a>
                </li>
            </ul>
        </li>

        <!-- Customers -->
        <li class="nav-item">
            <a asp-controller="UserManagement" asp-action="Index"
               class="nav-link @(IsController("UserManagement") && currentAction?.StartsWith("Index", StringComparison.OrdinalIgnoreCase) == true ? "active" : "")">
                <i class="nav-icon fas fa-users"></i>
                <p>Customers</p>
            </a>
        </li>

        <!-- Reports -->
        <li class="nav-item has-treeview @(IsController("Report") ? "menu-open" : "")">
            <a href="#" class="nav-link @(IsController("Report") ? "active" : "")">
                <i class="nav-icon fas fa-chart-bar"></i>
                <p>
                    Reports
                    <i class="right fas fa-angle-left"></i>
                </p>
            </a>
            <ul class="nav nav-treeview">
                <li class="nav-item">
                    <a asp-controller="Report" asp-action="Index"
                       class="nav-link @(IsController("Report") && currentAction?.StartsWith("index", StringComparison.OrdinalIgnoreCase) == true ? "active" : "")">
                        <i class="far fa-circle nav-icon"></i>
                        <p>Bus Reports</p>
                    </a>
                </li>
                <li class="nav-item">
                    <a asp-controller="Report" asp-action="Air"
                       class="nav-link @(IsController("Report") && currentAction?.StartsWith("Air", StringComparison.OrdinalIgnoreCase) == true ? "active" : "")">
                        <i class="far fa-circle nav-icon"></i>
                        <p>Air Reports</p>
                    </a>
                </li>
            </ul>
        </li>

        <!-- Send Notifications -->
        <li class="nav-item">
            <a asp-controller="Admin" asp-action="SendEmail"
               class="nav-link @(IsController("Admin") && currentAction?.StartsWith("SendEmail", StringComparison.OrdinalIgnoreCase) == true ? "active" : "")">
                <i class="nav-icon fas fa-envelope"></i>
                <p>Send Messages</p>
            </a>
        </li>
        <li class="nav-item">
            <a asp-controller="AdminMessages" asp-action="Index"
               class="nav-link @(IsController("AdminMessages") && currentAction?.StartsWith("Index", StringComparison.OrdinalIgnoreCase) == true ? "active" : "")">
                <i class="nav-icon fas fa-inbox"></i>
                <p>Get Messages</p>
            </a>
        </li>

        <!-- Logout -->
        <li class="nav-item mt-3">
            <form asp-area="Identity" asp-page="/Account/Logout" asp-route-returnUrl="@Url.Action("Index", "Home")" method="post">
                <button type="submit" class="nav-link btn btn-link text-left text-success w-100">
                    <i class="nav-icon fas fa-sign-out-alt"></i>
                    <p>Logout</p>
                </button>
            </form>
        </li>
    </ul>
</nav>
